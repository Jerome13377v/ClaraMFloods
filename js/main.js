
var currentMap = 0; // Global variable to hold the leaflet map object

var layerControl = 0;
var currentYear = 1833;

var Oberlin2= [
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21783318848895,41.291438038172316],[-82.2176904208286,41.291428520328225],[-82.2176973907541,41.29132397144434],[-82.21784015841445,41.29133348928826],[-82.21783318848895,41.291438038172316]]]},"properties":{"Id":0,"Name":"Oberlin Hall","YearBuilt":1833,"Year":1833,"IdNo":2}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21756668885628,41.29184640245826],[-82.21756023463672,41.29184583778722],[-82.21755397652535,41.29184416093133],[-82.21754810467174,41.29184142284102],[-82.21754279748914,41.29183770671177],[-82.21753821623366,41.29183312545629],[-82.21753450010442,41.29182781827371],[-82.2175317620141,41.291821946420086],[-82.21753008515822,41.291815688308716],[-82.21752952048718,41.29180923408916],[-82.21753008515822,41.2918027798696],[-82.2175317620141,41.29179652175823],[-82.21753450010442,41.291790649904605],[-82.21753821623366,41.29178534272202],[-82.21754279748914,41.29178076146655],[-82.21754810467172,41.2917770453373],[-82.21755397652535,41.29177430724698],[-82.21756023463672,41.291772630391094],[-82.21756668885628,41.29177206572005],[-82.21757314307584,41.291772630391094],[-82.21757940118721,41.29177430724698],[-82.21758527304083,41.2917770453373],[-82.21759058022342,41.29178076146655],[-82.2175951614789,41.29178534272202],[-82.21759887760814,41.291790649904605],[-82.21760161569846,41.29179652175823],[-82.21760329255434,41.2918027798696],[-82.21760385722538,41.29180923408916],[-82.21760329255434,41.291815688308716],[-82.21760161569846,41.291821946420086],[-82.21759887760814,41.29182781827371],[-82.2175951614789,41.29183312545629],[-82.21759058022342,41.29183770671177],[-82.21758527304084,41.29184142284102],[-82.21757940118721,41.29184416093133],[-82.21757314307584,41.29184583778722],[-82.21756668885628,41.29184640245826]]]},"properties":{"Id":0,"Name":"Historic Elm","YearBuilt":1833,"Year":1835,"IdNo":1}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21818687912616,41.29142515913884],[-82.21790134380547,41.29144657428776],[-82.21790848218848,41.29132522177645],[-82.21818687912616,41.29133236015946],[-82.21818687912616,41.29142515913884]]]},"properties":{"Id":0,"Name":"Building 2","YearBuilt":1834,"Year":1835,"IdNo":3}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21874367300154,41.29141802075577],[-82.21840103061658,41.29140374398969],[-82.21840464310856,41.291317044183415],[-82.21874728549346,41.291331320949496],[-82.21874367300154,41.29141802075577]]]},"properties":{"Id":0,"Name":"Building 3","YearBuilt":1834,"Year":1835,"IdNo":4}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21983584560314,41.29109679351984],[-82.21971449309189,41.29111820866899],[-82.21966519513126,41.29083885355908],[-82.21978654764257,41.29081743840999],[-82.21983584560314,41.29109679351984]]]},"properties":{"Id":0,"Name":"Building 4","YearBuilt":1834,"Year":1835,"IdNo":5}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21796558925257,41.29101113292376],[-82.21773716099597,41.29100399454069],[-82.21774095652654,41.29088253756538],[-82.21796938478309,41.29088967594822],[-82.21796558925257,41.29101113292376]]]},"properties":{"Id":0,"Name":"Building 5","YearBuilt":1834,"Year":1835,"IdNo":6}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21846527606382,41.293414150410165],[-82.21843846012517,41.29341180431953],[-82.21841245897525,41.29340483733241],[-82.21838806264584,41.29339346113717],[-82.21836601240706,41.29337802139376],[-82.21834697824427,41.29335898723096],[-82.21833153850085,41.29333693699218],[-82.21832016230562,41.29331254066277],[-82.2183131953185,41.29328653951285],[-82.21831084922786,41.2932597235742],[-82.2183131953185,41.293232907635556],[-82.21832016230562,41.293206906485636],[-82.21833153850085,41.29318251015622],[-82.21834697824427,41.293160459917445],[-82.21836601240706,41.29314142575465],[-82.21838806264584,41.29312598601123],[-82.21841245897525,41.293114609815994],[-82.21843846012517,41.29310764282887],[-82.21846527606382,41.29310529673824],[-82.21849209200248,41.29310764282887],[-82.2185180931524,41.293114609815994],[-82.2185424894818,41.29312598601123],[-82.21856453972059,41.29314142575465],[-82.21858357388338,41.293160459917445],[-82.2185990136268,41.29318251015622],[-82.21861038982203,41.293206906485636],[-82.21861735680915,41.293232907635556],[-82.21861970289979,41.2932597235742],[-82.21861735680915,41.29328653951285],[-82.21861038982203,41.29331254066277],[-82.2185990136268,41.29333693699218],[-82.21858357388338,41.29335898723096],[-82.21856453972059,41.29337802139376],[-82.2185424894818,41.29339346113717],[-82.2185180931524,41.29340483733241],[-82.21849209200248,41.29341180431953],[-82.21846527606382,41.293414150410165]]]},"properties":{"Id":0,"Name":"Building 6","YearBuilt":1835,"Year":1835,"IdNo":7}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.22059251420302,41.29202478331223],[-82.22027842535022,41.29199622978007],[-82.22029071273084,41.291861068593505],[-82.22060480158365,41.291889622125666],[-82.22059251420302,41.29202478331223]]]},"properties":{"Id":0,"Name":"Building 7","YearBuilt":1835,"Year":1835,"IdNo":8}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21783318848895,41.291438038172316],[-82.2176904208286,41.291428520328225],[-82.2176973907541,41.29132397144434],[-82.21784015841445,41.29133348928826],[-82.21783318848895,41.291438038172316]]]},"properties":{"Id":0,"Name":"Oberlin Hall","YearBuilt":1833,"Year":1834,"IdNo":2}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21756668885628,41.29184640245826],[-82.21756023463672,41.29184583778722],[-82.21755397652535,41.29184416093133],[-82.21754810467174,41.29184142284102],[-82.21754279748914,41.29183770671177],[-82.21753821623366,41.29183312545629],[-82.21753450010442,41.29182781827371],[-82.2175317620141,41.291821946420086],[-82.21753008515822,41.291815688308716],[-82.21752952048718,41.29180923408916],[-82.21753008515822,41.2918027798696],[-82.2175317620141,41.29179652175823],[-82.21753450010442,41.291790649904605],[-82.21753821623366,41.29178534272202],[-82.21754279748914,41.29178076146655],[-82.21754810467172,41.2917770453373],[-82.21755397652535,41.29177430724698],[-82.21756023463672,41.291772630391094],[-82.21756668885628,41.29177206572005],[-82.21757314307584,41.291772630391094],[-82.21757940118721,41.29177430724698],[-82.21758527304083,41.2917770453373],[-82.21759058022342,41.29178076146655],[-82.2175951614789,41.29178534272202],[-82.21759887760814,41.291790649904605],[-82.21760161569846,41.29179652175823],[-82.21760329255434,41.2918027798696],[-82.21760385722538,41.29180923408916],[-82.21760329255434,41.291815688308716],[-82.21760161569846,41.291821946420086],[-82.21759887760814,41.29182781827371],[-82.2175951614789,41.29183312545629],[-82.21759058022342,41.29183770671177],[-82.21758527304084,41.29184142284102],[-82.21757940118721,41.29184416093133],[-82.21757314307584,41.29184583778722],[-82.21756668885628,41.29184640245826]]]},"properties":{"Id":0,"Name":"Historic Elm","YearBuilt":1833,"Year":1834,"IdNo":1}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21818687912616,41.29142515913884],[-82.21790134380547,41.29144657428776],[-82.21790848218848,41.29132522177645],[-82.21818687912616,41.29133236015946],[-82.21818687912616,41.29142515913884]]]},"properties":{"Id":0,"Name":"Building 2","YearBuilt":1834,"Year":1834,"IdNo":3}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21874367300154,41.29141802075577],[-82.21840103061658,41.29140374398969],[-82.21840464310856,41.291317044183415],[-82.21874728549346,41.291331320949496],[-82.21874367300154,41.29141802075577]]]},"properties":{"Id":0,"Name":"Building 3","YearBuilt":1834,"Year":1834,"IdNo":4}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21983584560314,41.29109679351984],[-82.21971449309189,41.29111820866899],[-82.21966519513126,41.29083885355908],[-82.21978654764257,41.29081743840999],[-82.21983584560314,41.29109679351984]]]},"properties":{"Id":0,"Name":"Building 4","YearBuilt":1834,"Year":1834,"IdNo":5}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21796558925257,41.29101113292376],[-82.21773716099597,41.29100399454069],[-82.21774095652654,41.29088253756538],[-82.21796938478309,41.29088967594822],[-82.21796558925257,41.29101113292376]]]},"properties":{"Id":0,"Name":"Building 5","YearBuilt":1834,"Year":1834,"IdNo":6}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21783318848895,41.291438038172316],[-82.2176904208286,41.291428520328225],[-82.2176973907541,41.29132397144434],[-82.21784015841445,41.29133348928826],[-82.21783318848895,41.291438038172316]]]},"properties":{"Id":0,"Name":"Oberlin Hall","YearBuilt":1833,"Year":1833,"IdNo":2}},
{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-82.21756668885628,41.29184640245826],[-82.21756023463672,41.29184583778722],[-82.21755397652535,41.29184416093133],[-82.21754810467174,41.29184142284102],[-82.21754279748914,41.29183770671177],[-82.21753821623366,41.29183312545629],[-82.21753450010442,41.29182781827371],[-82.2175317620141,41.291821946420086],[-82.21753008515822,41.291815688308716],[-82.21752952048718,41.29180923408916],[-82.21753008515822,41.2918027798696],[-82.2175317620141,41.29179652175823],[-82.21753450010442,41.291790649904605],[-82.21753821623366,41.29178534272202],[-82.21754279748914,41.29178076146655],[-82.21754810467172,41.2917770453373],[-82.21755397652535,41.29177430724698],[-82.21756023463672,41.291772630391094],[-82.21756668885628,41.29177206572005],[-82.21757314307584,41.291772630391094],[-82.21757940118721,41.29177430724698],[-82.21758527304083,41.2917770453373],[-82.21759058022342,41.29178076146655],[-82.2175951614789,41.29178534272202],[-82.21759887760814,41.291790649904605],[-82.21760161569846,41.29179652175823],[-82.21760329255434,41.2918027798696],[-82.21760385722538,41.29180923408916],[-82.21760329255434,41.291815688308716],[-82.21760161569846,41.291821946420086],[-82.21759887760814,41.29182781827371],[-82.2175951614789,41.29183312545629],[-82.21759058022342,41.29183770671177],[-82.21758527304084,41.29184142284102],[-82.21757940118721,41.29184416093133],[-82.21757314307584,41.29184583778722],[-82.21756668885628,41.29184640245826]]]},"properties":{"Id":0,"Name":"Historic Elm","YearBuilt":1833,"Year":1833,"IdNo":1}}
]

var Oberlin = [{
    "type": "Feature",
    "properties": {"Name": "Arb", "Year": "1834", "Id": "0", "YearBuilt": "1834"},
    "geometry": {
        "type": "Polygon",
        "coordinates": [[[-82.22492829999999,41.287008600000036],[-82.22425349999997,41.286999800000046],[-82.22426839999997,41.28654250000005],[-82.22182019999997,41.28633830000007],[-82.22160439999999,41.28608340000005],[-82.22211439999995,41.285956000000056],[-82.22267839999995,41.285678500000074],[-82.22275709999997,41.28550300000006],[-82.22262589999997,41.285337800000036],[-82.22192539999998,41.285307000000046],[-82.22174419999999,41.285428600000046],[-82.22162569999995,41.285427500000026],[-82.22152169999998,41.28523450000006],[-82.22036059999994,41.285200400000065],[-82.22036409999998,41.284447800000066],[-82.22433709999996,41.28382320000003],[-82.22843239999997,41.283108500000026],[-82.22931209999996,41.28381800000005],[-82.22953749999994,41.28410820000005],[-82.22941899999995,41.285948500000075],[-82.22864249999998,41.286010100000055],[-82.22843309999996,41.28552150000007],[-82.22794619999996,41.28553380000005],[-82.22732879999995,41.28554610000003],[-82.22726429999994,41.28646260000005],[-82.22567059999994,41.28643820000008],[-82.22507699999994,41.28644430000003],[-82.22495609999999,41.28651320000006],[-82.22492829999999,41.287008600000036]]]
    }
}, {
    "type": "Feature",
    "properties": {"Name": "Tappan", "Year": "1833", "Id": "1", "YearBuilt": "1833"},
    "geometry": {
        "type": "Polygon",
        "coordinates": [[[-82.21997239999996,41.29175970000006],[-82.21995019999997,41.29232550000006],[-82.21987679999995,41.29414250000008],[-82.21877139999998,41.294141000000025],[-82.21738329999994,41.29412080000003],[-82.21736129999994,41.294120500000076],[-82.21741789999999,41.29287700000003],[-82.21746449999995,41.29185220000005],[-82.21749699999998,41.29172840000007],[-82.21758889999995,41.29170810000005],[-82.21822619999995,41.291722400000026],[-82.21888889999997,41.29174380000006],[-82.21997239999996,41.29175970000006]]]
    }
},
             {
    "type": "Feature",
    "properties": {"Name": "Tappan", "Year": "1834", "Id": "2", "YearBuilt": "1833"},
    "geometry": {
        "type": "Polygon",
        "coordinates": [[[-82.21997239999996,41.29175970000006],[-82.21995019999997,41.29232550000006],[-82.21987679999995,41.29414250000008],[-82.21877139999998,41.294141000000025],[-82.21738329999994,41.29412080000003],[-82.21736129999994,41.294120500000076],[-82.21741789999999,41.29287700000003],[-82.21746449999995,41.29185220000005],[-82.21749699999998,41.29172840000007],[-82.21758889999995,41.29170810000005],[-82.21822619999995,41.291722400000026],[-82.21888889999997,41.29174380000006],[-82.21997239999996,41.29175970000006]]]
    }
}];


var buildingLayer = L.geoJSON(false, {
    onEachFeature: onEachBuilding,
    filter: function(feature, layer) {
        if (feature.properties.Year == currentYear){
            feature.properties.Id = true;
        }
        else if(feature.properties.Year != currentYear){
            feature.properties.Id = false;
        }
        return feature.properties.Id;
    },
    style: function(feature) {
        console.log(feature.properties.YearBuilt);
        var buildingYearVariable = feature.properties.YearBuilt;
        var buildingYearVariableNum = Number(buildingYearVariable);
        var currentYearNum = Number(currentYear);
        
        
        if (buildingYearVariableNum == currentYearNum) {
            return {color: "#A06137", fillOpacity: 1, weight: 0};
            
        }
        else {
            return {color: "#131313", fillOpacity: 1, weight: 0};
        }

        
    }
});



function onEachBuilding(feature, layer) {

    var buildPopup = '<p><b>' + 'Building' + ':</b>&nbsp' + feature.properties.Name + '</p>';

    if (feature.properties && feature.properties.Name) {
        layer.bindPopup(buildPopup);
    }

}

// Function to instantiate the Leaflet map
function createMap(){
    
    // Add OSM base tilelayer and other base layers
    var customBaseLayer = L.tileLayer('https://api.mapbox.com/styles/v1/cmflood/ck61befo808t51in1yr5n0sul/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY21mbG9vZCIsImEiOiJjamt5OW01bzkwaDNkM3ZwNDdlMjkzbnhxIn0.YM5MN8JltD_tvyZY0qMnRQ', {
        attribution: '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> | <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 25,
        id: 'cmflood',
        detectRetina: true //keeps tileset from being blurry on high res screens
    });

    //base layer options
    var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
        'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiY21mbG9vZCIsImEiOiJjamt5OW01bzkwaDNkM3ZwNDdlMjkzbnhxIn0.YM5MN8JltD_tvyZY0qMnRQ';

    var grayscaleBase   = L.tileLayer(mbUrl, {
        id: 'mapbox.light',
        attribution: mbAttr,
        detectRetina: true
    })

    var OpenMapSurfer_Hillshade = L.tileLayer('https://maps.heigit.org/openmapsurfer/tiles/asterh/webmercator/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> | Map data  <a href="https://lpdaac.usgs.gov/products/aster_policies">ASTER GDEM</a>, <a href="http://srtm.csi.cgiar.org/">SRTM</a>',
        detectRetina: true
    });
    
    // Create the map
    var mapid = L.map('map', {
        center: [41.29237, -82.216],
        zoom: 15,
        zoomSnap: 0.2, //setting this overides the default value of 1 which means the zoom levels can be in integers/multiples of this number
        //set to false to overide default position
        zoomControl: false,
        layers: customBaseLayer //sets which base layer is loaded first
    });

    //add zoom control with original extent button that references leaflet plugin zoomhome
    var zoomHome = L.Control.zoomHome({
        position: 'bottomright',
        zoomHomeIcon: 'globe'
    });
    zoomHome.addTo(mapid);
    
    
    var baseLayers = {
        "Plain": grayscaleBase,
        "Terrain": OpenMapSurfer_Hillshade,
        "Main": customBaseLayer
    };

    layerControl = new L.control.layers(baseLayers, null).addTo(mapid);
    
    
    buildingLayer.addTo(mapid); //adds empty layer to map
    buildingLayer.addData(Oberlin2); //populates empty layer with geojson data
    layerControl.addOverlay(buildingLayer, "Buildings"); //adds layer control of wolf pack

    
    // Set global map variable to map object
    currentMap = mapid;

};



//function to open wolf form
$(function(){
    $("#buildingDirec").click(function(){
        $('.collapse').collapse('hide'); //closes the location nav menu when the side opens
        $('#timeHolder').hide(500);
        $('#buildHolder').show('slow');
    });
});

//function to close wolf form
$(function(){
    $('#buildClose').click(function() {
        $('#buildHolder').hide(500);

    });
});

//function to open time area
$(function(){
    $("#timebtn").click(function(){
        $('.collapse').collapse('hide'); //closes the location nav menu when the side opens
        $('#buildHolder').hide(500);
        $('#timeHolder').show('slow');
    });
});

//function to close time sidebar
$(function(){
    $('#timesearchClose').click(function() {
        $('#timeHolder').hide(500);
    });
});

$(function(){
    $("#year_submit_btn").click(function(event){
        event.preventDefault();
        
        
        var yearArray = $("#year_form").serializeArray();
        console.log(yearArray);
        console.log(yearArray[0].value);
        currentYear = yearArray[0].value;
        
        buildingLayer.clearLayers();
        buildingLayer.addData(Oberlin2);
        $("#yearHeader" ).empty();
        $('#yearHeader').append("<h3><b>"+currentYear+"</b></h3>");

    });
});


//sort tables by headers
var getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

var comparer = (idx, asc) => (a, b) => ((v1, v2) => 
    v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
    )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

// do the work...
document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
    var table = th.closest('table');
    Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
        .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
        .forEach(tr => table.appendChild(tr) );
})));


$(document).ready(createMap);



